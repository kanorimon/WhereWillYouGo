<!DOCTYPE html>
<html>
<head>
  <title>Mapapp</title>
  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
  <%= csrf_meta_tags %>
  
  <script type="text/javascript"
  src="http://maps.google.com/maps/api/js?sensor=false"></script>
      <script type="text/javascript">
 function initialize() { 
    
    var circleObj;
    //東京駅を中心に地図を表示。 
    var myLatlng = new google.maps.LatLng(35.681382, 139.766084); 
    var options = { 
        //地図のズームサイズ 
        zoom: 15, 
        //地図の中心地 
        center: myLatlng, 
        mapTypeId: google.maps.MapTypeId.ROADMAP 
    }; 
    var map = new google.maps.Map(document.getElementById("map"), options); 
    
    //地図をクリックされた時のイベント 
    google.maps.event.addListener(map, 'center_changed', function(event) { 
      var mapcenter = map.getCenter();
      document.getElementById("point_lng").value = mapcenter.lng();
      document.getElementById("point_lat").value = mapcenter.lat();

      input_radius = parseInt(document.getElementById("point_radius").value);
        
    if(circleObj){
      circleObj.setMap(null);
     }
        //円を描く 
    var circleOptions = { 
        map: map, 
        center: map.getCenter(),
        radius: input_radius, 
        strokeColor: "#55555", 
        strokeOpacity: 1, 
        strokeWeight: 1, 
        fillColor: "#555555", 
        fillOpacity: 0.1
    }; 
    circleObj = new google.maps.Circle(circleOptions); 


    })
    
    
    
  $('#getad').click(function() {
 
    var sad = $('#address').val();
    var geocoder = new google.maps.Geocoder();
 
    geocoder.geocode({ 'address': sad}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
 
        map.setCenter(results[0].geometry.location);
        marker.setPosition(results[0].geometry.location);
 
        var p = marker.position;
        $('#lat').val(p.lat());
        $('#lng').val(p.lng());
      } else {
        alert('住所から場所を特定できませんでした。最初にビル名などを省略し、番地までの検索などでお試しください。');
      }
    });
 
    return false;
 
  });


  };
  


    </script>

    
</head>
<body onload="initialize()">

<%= yield %>

</body>
</html>
